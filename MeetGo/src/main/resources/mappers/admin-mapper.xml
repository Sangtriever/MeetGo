<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="adminMapper">
	
   	<resultMap id="estimateResultSet" type="estimate">
       <result column="EST_NO" property="estNo"/>
       <result column="EST_TITLE" property="estTitle"/>
       <result column="EST_CONTENT" property="estContent"/>
       <result column="EST_ADDRESS" property="estAddress"/>
       <result column="EST_SERVICE" property="estService"/>
       <result column="START_DATE" property="startDate"/>
       <result column="END_DATE" property="endDate"/>
       <result column="CONFIRMATION_DATE" property="confirmationDate"/>
       <result column="EST_PRICE" property="estPrice"/>
       <result column="STATUS" property="status"/>
       <result column="TID" property="tid"/>
       <result column="GOSU_NO" property="gosuNo"/>
       <result column="USER_NO" property="userNo"/>
    </resultMap>
	
    <resultMap id="reviewImgResultSet" type="reviewImg">
       <result column="IMG_NO" property="imgNo"/>
       <result column="REV_IMG_URL" property="revImgUrl"/>
       <result column="REV_NO" property="revNo"/>
    </resultMap>
	
	
	<!-- 관리자 계약관리용 -->
	<select id="adminEstimateInComplListCount" resultType="_int">
		SELECT COUNT(*)
		  FROM ESTIMATE
		 WHERE (STATUS = '3' OR STATUS = '4')
	</select>
		
	<select id="adminEstimateComplListCount" resultType="_int">
		SELECT COUNT(*)
		  FROM ESTIMATE
		 WHERE STATUS = '5'
	</select>
	
	<select id="adminEstimateInComplList" resultMap="estimateResultSet">
		SELECT EST_NO
		     , EST_TITLE
		     , EST_CONTENT
		     , EST_ADDRESS
		     , EST_SERVICE
		     , TO_CHAR(START_DATE, 'YYYY-MM-DD') as START_DATE
		     , END_DATE
		     , TO_CHAR(CONFIRMATION_DATE, 'YYYY-MM-DD') as CONFIRMATION_DATE
		     , EST_PRICE
		     , STATUS
		     , TID
		     , GOSU_NO
		     , USER_NO
		  FROM ESTIMATE
		 WHERE (STATUS = '3' OR STATUS = '4')
    </select>
    
    <select id="adminEstimateComplList" resultType="estimateDto">
		SELECT EST_NO as "estimate.estNo"
		     , EST_TITLE as "estimate.estTitle"
		     , EST_CONTENT as "estimate.estContent"
		     , EST_ADDRESS as "estimate.estAddress"
		     , EST_SERVICE as "estimate.estService"
		     , TO_CHAR(START_DATE, 'YYYY-MM-DD') as "estimate.startDate"
		     , END_DATE "estimate.endDate"
		     , TO_CHAR(CONFIRMATION_DATE, 'YYYY-MM-DD') as "estimate.confirmationDate"
		     , EST_PRICE "estimate.estPrice"
		     , STATUS "estimate.status"
		     , TID "estimate.tid"
		     , GOSU_NO "estimate.gosuNo"
		     , USER_NO "estimate.userNo"
		     , (SELECT COUNT(*)
		          FROM REVIEW
		         WHERE REVIEW.EST_NO = ESTIMATE.EST_NO) AS "reviewCnt"
		     , (SELECT REV_NO
		          FROM REVIEW
		         WHERE REVIEW.EST_NO = ESTIMATE.EST_NO) AS "revNo"
		  FROM ESTIMATE
		 WHERE STATUS = '5'
    </select>
	
	<select id="adminEstimateDetail" parameterType="_int" resultType="estimateDto">
		SELECT EST_NO as "estimate.estNo"
             , EST_TITLE as "estimate.estTitle"
             , EST_CONTENT as "estimate.estContent"
             , EST_ADDRESS as "estimate.estAddress"
             , EST_SERVICE as "estimate.estService" 
             , TO_CHAR(START_DATE, 'YYYY-MM-DD') as "estimate.startDate"
             , END_DATE as "estimate.endDate"
             , TO_CHAR(CONFIRMATION_DATE, 'YYYY-MM-DD') as "estimate.confirmationDate"
             , EST_PRICE as "estimate.estPrice"
             , STATUS as "estimate.status"
             , TID as "estimate.tid"
             , GOSU_NO as "estimate.gosuNo"
             , USER_NO as "estimate.userNo"
             , (SELECT USER_NAME
             	  FROM MEMBER M
             	 WHERE E.USER_NO = M.USER_NO) as "userName"
             , (SELECT USER_NAME
             	  FROM MEMBER M
             	 WHERE E.GOSU_NO = M.USER_NO) as "gosuName"
          FROM ESTIMATE E
         WHERE EST_NO = #{eno}	
	</select>
	<!-- 관리자 계약관리용 끝 -->
	
	<!-- 관리자 리뷰관리용 -->
	<select id="selectReviewListCount" resultType="_int">
		SELECT COUNT(*)
		  FROM REVIEW
		 WHERE REV_STATUS = '1'
	</select>
 
	<select id="selectReviewList" resultType="reviewDto">
		SELECT R.REV_NO as "review.revNo"
             , R.REV_CONTENT as "review.revContent"
             , R.REV_POINT as "review.revPoint"
             , TO_CHAR(R.REV_DATE, 'YYYY-MM-DD') as "review.revDate"
             , R.GOSU_NO as "review.gosuNo"
             , R.USER_NO as "review.userNo"
             , R.EST_NO as "review.estNo"
             , (SELECT USER_NAME
             	  FROM MEMBER M
             	 WHERE R.USER_NO = M.USER_NO) as "userName"
             , (SELECT USER_NAME
             	  FROM MEMBER M
             	 WHERE R.GOSU_NO = M.USER_NO) as "gosuName"
             , (SELECT EST_TITLE
             	  FROM ESTIMATE E
             	 WHERE R.EST_NO = E.EST_NO) as "estTitle"
          FROM REVIEW R
         WHERE REV_STATUS = '1'
         ORDER BY REV_NO DESC
	</select>
	
	<select id="adminReviewDetail" parameterType="_int" resultType="reviewDto">
		SELECT REV_NO AS "review.revNo"
            , REV_CONTENT AS "review.revContent"
            , REV_POINT AS "review.revPoint"
            , TO_CHAR(REV_DATE, 'YYYY-MM-DD') AS "review.revDate"
            , REV_STATUS AS "review.revStatus"
            , EST_NO AS "review.estNo"
            , USER_NO AS "review.userNo"
            , GOSU_NO AS "review.gosuNo"
            , (SELECT USER_NAME
                 FROM MEMBER
                WHERE R.USER_NO = MEMBER.USER_NO) AS "userName"
            , (SELECT USER_NAME
                 FROM MEMBER
                WHERE R.GOSU_NO = MEMBER.USER_NO) AS "gosuName"
            , (SELECT EST_TITLE
                 FROM ESTIMATE
                WHERE R.EST_NO = ESTIMATE.EST_NO) AS "estTitle"
         FROM REVIEW R
        WHERE R.REV_NO = #{rno}
	</select>
	
	<select id="adminReviewImg" parameterType="_int" resultMap="reviewImgResultSet">
       SELECT *
         FROM REVIEW_IMG
        WHERE REV_NO = #{rno}
    </select>
	<!-- 관리자 리뷰관리용 끝 -->
</mapper>